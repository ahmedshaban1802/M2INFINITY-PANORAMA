<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„ (Ø­Ø¶ÙˆØ± - Ù…Ø±ØªØ¨Ø§Øª)</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #4361ee;
            --primary-dark: #3a0ca3;
            --success: #2ec4b6;
            --danger: #ef476f;
            --warning: #ffd166;
            --info: #4cc9f0;
            --dark: #2b2d42;
            --light: #f8f9fa;
            --gray: #8d99ae;
            --bg-grad: linear-gradient(135deg, #fdfbfb 0%, #ebedee 100%);
            --shadow: 0 10px 30px -10px rgba(0,0,0,0.08);
            --radius: 16px;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; outline: none; -webkit-tap-highlight-color: transparent; }
        
        body {
            background: var(--bg-grad);
            color: var(--dark);
            min-height: 100vh;
            padding: 20px;
            overflow-x: hidden;
        }
        
        .container { max-width: 1400px; margin: 0 auto; transition: all 0.3s ease; }
        
        /* Header */
        header {
            background: white; border-radius: var(--radius); padding: 20px 30px;
            box-shadow: var(--shadow); display: flex; justify-content: space-between;
            align-items: center; margin-bottom: 25px; flex-wrap: wrap; gap: 15px;
            border-bottom: 4px solid var(--primary);
        }
        .brand { display: flex; align-items: center; gap: 12px; flex-shrink: 0; }
        .brand-icon {
            width: 45px; height: 45px; background: var(--primary); color: white;
            border-radius: 12px; display: flex; align-items: center; justify-content: center;
            font-size: 20px; box-shadow: 0 4px 15px rgba(67, 97, 238, 0.4);
        }
        h2 { font-size: 20px; font-weight: 800; color: var(--dark); white-space: nowrap; }
        
        /* UPDATED HEADER TOOLS FOR STACKING */
        .header-tools { 
            display: flex; 
            gap: 10px; 
            align-items: flex-end; 
            flex-direction: column; /* Stack items vertically */
        }

        /* NEW SITE STATUS STYLE */
        .site-status {
            background: #fff;
            color: var(--primary-dark);
            font-weight: 700;
            font-size: 13px;
            padding: 8px 15px;
            border-radius: 50px;
            border: 1px solid #e0e7ff;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 15px rgba(67, 97, 238, 0.05);
            white-space: nowrap;
            letter-spacing: 0.5px;
            animation: fadeInDown 0.5s ease;
        }
        @keyframes fadeInDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Live Clock */
        .live-clock {
            background: #eef2ff; color: var(--primary); padding: 8px 15px; border-radius: 20px;
            font-family: 'Courier New', monospace; font-weight: 700; font-size: 16px;
            border: 1px solid #dbeafe; display: flex; align-items: center; gap: 8px;
            letter-spacing: 1px; flex-shrink: 0;
        }

        /* --- TAB NAVIGATION --- */
        .main-tabs {
            display: flex;
            background: white;
            padding: 5px;
            border-radius: 50px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.05);
            margin-bottom: 25px;
            width: fit-content;
            margin-right: auto;
            margin-left: auto;
        }
        .tab-btn {
            padding: 10px 30px;
            border-radius: 40px;
            border: none;
            background: transparent;
            color: var(--gray);
            font-weight: 700;
            font-size: 15px;
            cursor: pointer;
            transition: 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .tab-btn.active {
            background: var(--primary);
            color: white;
            box-shadow: 0 4px 15px rgba(67, 97, 238, 0.3);
        }
        .tab-content { display: none; animation: fadeIn 0.4s ease; }
        .tab-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Stats */
        .stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 20px; margin-bottom: 25px; }
        .stat-card {
            background: white; padding: 20px; border-radius: var(--radius);
            box-shadow: var(--shadow); display: flex; align-items: center; gap: 15px;
            transition: transform 0.3s ease; border: 1px solid rgba(0,0,0,0.02);
        }
        .stat-card:hover { transform: translateY(-5px); }
        .s-icon {
            width: 50px; height: 50px; border-radius: 12px; display: flex; align-items: center;
            justify-content: center; font-size: 20px;
        }
        .s-info h4 { font-size: 12px; color: var(--gray); margin-bottom: 2px; }
        .s-info span { font-size: 24px; font-weight: 800; color: var(--dark); }
        .c-pres { background: rgba(46, 196, 182, 0.1); color: var(--success); }
        .c-abs { background: rgba(239, 71, 111, 0.1); color: var(--danger); }
        .c-lev { background: rgba(255, 209, 102, 0.1); color: #e0aa00; }
        .c-money { background: rgba(67, 97, 238, 0.1); color: var(--primary); }

        /* Controls Panel */
        .panel { background: white; padding: 25px; border-radius: var(--radius); box-shadow: var(--shadow); margin-bottom: 25px; }
        .input-group { position: relative; margin-bottom: 20px; }
        .input-group label { display: block; font-size: 13px; font-weight: 700; color: var(--gray); margin-bottom: 8px; }
        .input-group i { position: absolute; right: 15px; top: 40px; color: #ccc; transition: 0.3s; pointer-events:none;}
        .inp { width: 100%; padding: 12px 45px 12px 15px; border: 2px solid #eee; border-radius: 12px; font-size: 15px; transition: 0.3s; background: #fcfcfc; }
        .inp:focus { border-color: var(--primary); background: white; box-shadow: 0 0 0 4px rgba(67,97,238,0.05); }
        .inp:focus + i { color: var(--primary); }

        /* Toggle Time */
        .toggle-container {
            background: #f8faff; border: 1px solid #e0e7ff; border-radius: 12px;
            padding: 15px 20px; display: flex; justify-content: space-between;
            align-items: center; margin-bottom: 15px; box-shadow: 0 2px 5px rgba(67, 97, 238, 0.03);
        }
        .toggle-text { font-size: 14px; font-weight: 700; color: var(--dark); display: flex; align-items: center; gap: 8px; }
        .toggle-text i { color: var(--primary); }

        .switch { position: relative; display: inline-block; width: 54px; height: 30px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider {
            position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0;
            background-color: #cbd5e1; transition: .4s cubic-bezier(0.4, 0.0, 0.2, 1);
            border-radius: 34px; box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
        }
        .slider:before {
            position: absolute; content: ""; height: 22px; width: 22px; left: 4px; bottom: 4px;
            background-color: white; transition: .4s cubic-bezier(0.4, 0.0, 0.2, 1);
            border-radius: 50%; box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        input:checked + .slider { background-color: var(--primary); box-shadow: 0 0 10px rgba(67, 97, 238, 0.4); }
        input:checked + .slider:before { transform: translateX(24px); }

        .time-sliding-wrapper {
            max-height: 0; overflow: hidden; opacity: 0; transform: translateY(-10px);
            transition: all 0.4s cubic-bezier(0.4, 0.0, 0.2, 1); margin-bottom: 0;
        }
        .time-sliding-wrapper.active { max-height: 80px; opacity: 1; transform: translateY(0); margin-bottom: 20px; }
        .time-input-box { background: white; border: 2px dashed #cbd5e1; border-radius: 10px; padding: 10px 15px; display: flex; align-items: center; gap: 10px; }
        .time-input-box input[type="time"] { border: none; background: transparent; font-family: inherit; font-size: 16px; color: var(--dark); font-weight: 600; width: 100%; outline: none; }

        /* Buttons Grid */
        .btn-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 12px; }
        .btn {
            padding: 14px; border: none; border-radius: 12px; color: white; font-weight: 700;
            cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px;
            transition: 0.3s; font-size: 14px; position: relative; overflow: hidden; white-space: nowrap;
        }
        .btn:active { transform: scale(0.98); }
        .btn::after { content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(rgba(255,255,255,0.2), transparent); opacity: 0; transition: 0.3s; }
        .btn:hover::after { opacity: 1; }
        .b-in { background: linear-gradient(135deg, #2ec4b6 0%, #20a4a4 100%); box-shadow: 0 4px 15px rgba(46, 196, 182, 0.3); }
        .b-out { background: linear-gradient(135deg, #ef476f 0%, #d6335c 100%); box-shadow: 0 4px 15px rgba(239, 71, 111, 0.3); }
        .b-abs { background: linear-gradient(135deg, #ffd166 0%, #ffbd00 100%); color: #5d4000; box-shadow: 0 4px 15px rgba(255, 209, 102, 0.3); }
        .b-ded { background: linear-gradient(135deg, #7209b7 0%, #560bad 100%); box-shadow: 0 4px 15px rgba(114, 9, 183, 0.3); }
        .b-del { background: white; color: var(--danger); border: 2px solid #fee2e2; }
        .b-del:hover { background: #fee2e2; }
        .b-money { background: linear-gradient(135deg, #4361ee 0%, #3a0ca3 100%); box-shadow: 0 4px 15px rgba(67, 97, 238, 0.3); }

        .tools { display: flex; gap: 10px; margin-top: 20px; padding-top: 20px; border-top: 1px dashed #eee; }
        .tool-btn {
            flex: 1; padding: 10px; border-radius: 10px; border: 1px solid #eee; background: white;
            color: var(--gray); cursor: pointer; transition: 0.3s; font-size: 13px; display: flex; align-items: center; justify-content: center; gap: 6px;
        }
        .tool-btn:hover { border-color: var(--primary); color: var(--primary); background: #f8faff; }

        /* Table */
        .table-wrap { background: white; border-radius: var(--radius); box-shadow: var(--shadow); overflow-x: auto; position:relative; z-index:1;}
        .t-head {
            background: #f8f9fa; padding: 15px 25px; border-bottom: 1px solid #eee;
            display: flex; justify-content: space-between; align-items: center; min-width: 700px;
        }
        .view-date { font-weight: 800; color: var(--primary); font-size: 16px; }
        .nav-btns { display: flex; gap: 5px; }
        .nav-btn {
            width: 32px; height: 32px; border-radius: 8px; border: 1px solid #ddd; background: white;
            color: var(--gray); display: flex; align-items: center; justify-content: center;
            cursor: pointer; transition: 0.2s;
        }
        .nav-btn:hover { background: var(--primary); color: white; border-color: var(--primary); }

        table { width: 100%; border-collapse: collapse; min-width: 800px; }
        th { padding: 12px; text-align: center; font-size: 13px; color: var(--gray); font-weight: 700; background: #fdfdfd; white-space: nowrap; }
        td { padding: 8px; text-align: center; border-bottom: 1px solid #f8f9fa; font-size: 14px; color: var(--dark); white-space: nowrap; vertical-align: middle;}
        tr:last-child td { border-bottom: none; }
        tr:hover td { background: #fafafa; }

        .badge { padding: 4px 10px; border-radius: 20px; font-size: 11px; font-weight: 700; }
        .bg-pres { background: rgba(46, 196, 182, 0.15); color: #16a096; }
        .bg-abs { background: rgba(239, 71, 111, 0.15); color: #d6335c; }
        .bg-lev { background: rgba(255, 209, 102, 0.15); color: #d4a000; }

        .action-btn { width: 28px; height: 28px; border-radius: 6px; border: 1px solid #eee; background: white; color: var(--primary); cursor: pointer; transition: 0.2s; display: inline-flex; align-items: center; justify-content: center; margin: 0 2px; }
        .action-btn:hover { background: var(--primary); color: white; }
        .action-btn.del:hover { background: var(--danger); border-color: var(--danger); color: white; }

        /* Modals */
        .modal {
            display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.5);
            backdrop-filter: blur(5px); z-index: 100; align-items: center; justify-content: center;
        }
        .modal-content {
            background: white; width: 90%; max-width: 450px; padding: 30px; border-radius: 20px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.2); animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        @keyframes popIn { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }
        .m-head { display: flex; justify-content: space-between; margin-bottom: 20px; }
        .m-title { font-size: 18px; font-weight: 800; color: var(--dark); }
        .m-close { width: 30px; height: 30px; border-radius: 50%; border: none; background: #eee; cursor: pointer; color: #666; transition: 0.2s; }
        .m-close:hover { background: var(--danger); color: white; }
        
        .edit-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .full { grid-column: span 2; }
        textarea.inp { resize: none; height: 80px; }

        /* Toast */
        .toast {
            position: fixed; top: 20px; left: 20px; background: white; padding: 15px 25px;
            border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            display: flex; align-items: center; gap: 10px; transform: translateX(-150%);
            transition: transform 0.4s cubic-bezier(0.68, -0.55, 0.27, 1.55); z-index: 200;
            border-right: 5px solid;
        }
        .toast.show { transform: translateX(0); }
        .toast.success { border-color: var(--success); }
        .toast i { font-size: 18px; }
        .toast.success i { color: var(--success); }

        /* Footer */
        footer {
            text-align: center; margin-top: 40px; padding: 25px;
            background: white; border-radius: var(--radius);
            box-shadow: 0 -5px 20px rgba(0,0,0,0.05);
            border-top: 4px solid var(--primary);
        }
        .dev-signature {
            font-size: 18px; font-weight: 800; color: var(--primary);
            display: flex; align-items: center; justify-content: center; gap: 10px;
        }

        /* Salary Suggestions List */
        #suggestionList {
            position: absolute;
            top: 100%;
            right: 0;
            left: 0;
            background: white;
            border: 1px solid #eee;
            border-radius: 8px;
            list-style: none;
            max-height: 200px;
            overflow-y: auto;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            display: none;
            z-index: 1000; 
            padding: 0;
            margin-top: 5px;
        }
        #suggestionList li {
            padding: 10px 15px;
            cursor: pointer;
            border-bottom: 1px solid #f9f9f9;
            transition: 0.2s;
        }
        #suggestionList li:hover {
            background: #f0f8ff;
            color: var(--primary);
        }

        /* --- RESPONSIVE --- */
        @media (max-width: 768px) {
            body { padding: 10px; background: #eef2f5; }
            .container { width: 100%; max-width: 100%; padding: 0; }
            header { flex-wrap: nowrap; overflow-x: auto; padding: 15px; align-items: stretch; gap: 15px; border-bottom: none; margin-bottom: 15px; }
            .brand { display: flex; flex-direction: column; align-items: flex-start; justify-content: center; min-width: 100px; }
            h2 { font-size: 16px; }
            .header-tools { display: flex; gap: 10px; min-width: max-content; }
            
            .main-tabs { width: 100%; justify-content: space-between; margin-bottom: 15px; border-radius: 12px; overflow: hidden; }
            .tab-btn { flex: 1; justify-content: center; padding: 10px; font-size: 13px; border-radius: 0; }
            .tab-btn.active { border-radius: 0; }

            .stats { display: flex; overflow-x: auto; gap: 15px; padding-bottom: 5px; margin-bottom: 15px; }
            .stat-card { min-width: 160px; flex-shrink: 0; padding: 15px; }
            .s-icon { width: 40px; height: 40px; }
            .s-info h4 { font-size: 11px; }
            .s-info span { font-size: 18px; }
            .panel { padding: 15px; margin-bottom: 15px; border-radius: 12px; }
            .btn-grid { display: flex; overflow-x: auto; gap: 10px; padding-bottom: 10px; }
            .btn { min-width: 80px; flex: 0 0 auto; flex-direction: column; padding: 12px 8px; font-size: 12px; gap: 5px; border-radius: 10px; }
            .btn i { font-size: 18px; margin: 0; }
            .table-wrap { overflow-x: auto; border-radius: 12px; }
            table { min-width: 800px; }
            .t-head { min-width: 800px; }
            .tools { overflow-x: auto; gap: 8px; padding-top: 15px; }
            .tool-btn { min-width: 100px; flex-shrink: 0; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="brand">
                <div class="brand-icon"><i class="fas fa-clock"></i></div>
                <div>
                    <h2>Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„</h2>
                    <div style="font-size:11px; color:var(--gray);">Ø­Ø¶ÙˆØ± ÙˆØ§Ù†ØµØ±Ø§Ù | Ù…Ø±ØªØ¨Ø§Øª</div>
                </div>
            </div>
            <div class="header-tools">
                <!-- NEW SITE STATUS MESSAGE -->
                <div class="site-status">
                    <i class="fas fa-tools"></i>
                    Ø§Ù„Ù…ÙˆÙ‚Ø¹ ØªØ­Øª Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡ Ùˆ ÙŠØªÙ… ØªØ¬Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ ÙŠÙˆÙ…ÙŠØ§Ù‹
                </div>
                
                <div class="live-clock">
                    <i class="far fa-clock"></i>
                    <span id="clockDisplay">--:--:--</span>
                </div>
            </div>
        </header>

        <!-- Navigation Tabs -->
        <div class="main-tabs">
            <button class="tab-btn active" onclick="switchTab('attendance')">
                <i class="fas fa-calendar-check"></i> Ø§Ù„Ø­Ø¶ÙˆØ± ÙˆØ§Ù„Ø§Ù†ØµØ±Ø§Ù
            </button>
            <button class="tab-btn" onclick="switchTab('salaries')">
                <i class="fas fa-money-bill-wave"></i> Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø±ØªØ¨Ø§Øª
            </button>
        </div>
        
        <!-- TAB 1: ATTENDANCE -->
        <div id="attendance" class="tab-content active">
            <div class="stats">
                <div class="stat-card">
                    <div class="s-icon c-pres"><i class="fas fa-user-check"></i></div>
                    <div class="s-info"><h4>Ø§Ù„Ø­Ø¶ÙˆØ±</h4><span id="presentCount">0</span></div>
                </div>
                <div class="stat-card">
                    <div class="s-icon c-abs"><i class="fas fa-user-times"></i></div>
                    <div class="s-info"><h4>Ø§Ù„ØºÙŠØ§Ø¨</h4><span id="absentCount">0</span></div>
                </div>
                <div class="stat-card">
                    <div class="s-icon c-lev"><i class="fas fa-sign-out-alt"></i></div>
                    <div class="s-info"><h4>Ø§Ù„Ø§Ù†ØµØ±Ø§Ù</h4><span id="leaveCount">0</span></div>
                </div>
            </div>
            
            <div class="panel">
                <div class="input-group">
                    <label>Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù</label>
                    <input type="text" id="employeeName" class="inp" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø§Ø³Ù… Ù‡Ù†Ø§...">
                    <i class="fas fa-user"></i>
                </div>

                <div class="toggle-container">
                    <div class="toggle-text"><i class="fas fa-stopwatch"></i> ØªØ«Ø¨ÙŠØª Ø§Ù„ÙˆÙ‚Øª ÙŠØ¯ÙˆÙŠØ§Ù‹</div>
                    <label class="switch">
                        <input type="checkbox" id="manualTimeToggle" onchange="toggleTimeInput()">
                        <span class="slider"></span>
                    </label>
                </div>

                <div id="manualTimeInputGroup" class="time-sliding-wrapper">
                    <div class="time-input-box">
                        <i class="far fa-clock" style="color:var(--primary); font-size:18px;"></i>
                        <input type="time" id="manualTimeInput">
                    </div>
                </div>

                <div class="btn-grid">
                    <button class="btn b-in" onclick="addAttendance()"><i class="fas fa-sign-in-alt"></i> Ø­Ø¶ÙˆØ±</button>
                    <button class="btn b-out" onclick="addLeave()"><i class="fas fa-sign-out-alt"></i> Ø§Ù†ØµØ±Ø§Ù</button>
                    <button class="btn b-abs" onclick="markAbsent()"><i class="fas fa-user-slash"></i> ØºÙŠØ§Ø¨</button>
                    <button class="btn b-ded" onclick="showDeductionInput()"><i class="fas fa-file-invoice"></i> Ø®ØµÙ…</button>
                    <button class="btn b-del" onclick="deleteEmployee()"><i class="fas fa-trash"></i> Ø­Ø°Ù</button>
                </div>

                <div id="deductionBox" style="display:none; margin-top:15px; animation: fadeIn 0.3s;">
                    <div class="input-group">
                        <label>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø®ØµÙ…</label>
                        <div style="display:flex; gap:10px;">
                            <input type="text" id="deductionInput" class="inp" placeholder="Ù…Ø«Ø§Ù„: Ø®ØµÙ… ÙŠÙˆÙ…...">
                            <button class="btn b-ded" onclick="saveDeduction()" style="width:auto; padding:0 20px;"><i class="fas fa-check"></i></button>
                        </div>
                    </div>
                </div>

                <div class="tools">
                    <div class="date-box" style="background:var(--light); padding:8px 15px; border-radius:30px; border:1px solid #eee; display:flex; align-items:center; gap:8px; flex:1; max-width:250px;">
                        <i class="far fa-calendar-alt" style="color:var(--primary)"></i>
                        <input type="date" id="dateFilter" style="border:none; background:transparent; font-size:15px; font-weight:600; color:var(--dark); width:100%;">
                    </div>
                    <button class="tool-btn" onclick="exportExcel()"><i class="fas fa-file-excel" style="color:#107c41"></i> Excel</button>
                    <button class="tool-btn" onclick="exportWhatsApp()"><i class="fab fa-whatsapp" style="color:#25D366"></i> ÙˆØ§ØªØ³Ø§Ø¨ + Excel</button>
                    <button class="tool-btn" onclick="confirmClear()"><i class="fas fa-eraser" style="color:var(--danger)"></i> Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„</button>
                </div>
            </div>
            
            <div class="table-wrap">
                <div class="t-head">
                    <div class="view-date" id="viewDateDisplay">...</div>
                    <div class="nav-btns">
                        <button class="nav-btn" onclick="changeDate(-1)"><i class="fas fa-chevron-right"></i></button>
                        <button class="nav-btn" onclick="setToday()"><i class="far fa-calendar-check"></i></button>
                        <button class="nav-btn" onclick="changeDate(1)"><i class="fas fa-chevron-left"></i></button>
                    </div>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>Ø§Ù„Ø§Ø³Ù…</th>
                            <th>Ø­Ø¶ÙˆØ±</th>
                            <th>Ø§Ù†ØµØ±Ø§Ù</th>
                            <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                            <th>Ø§Ù„Ø®ØµÙ…</th>
                            <th>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th>
                            <th>ØªØ¹Ø¯ÙŠÙ„</th>
                        </tr>
                    </thead>
                    <tbody id="tableBody"></tbody>
                </table>
            </div>
        </div>

        <!-- TAB 2: SALARIES (MANUAL ONLY) -->
        <div id="salaries" class="tab-content">
            <div class="stats">
                <div class="stat-card">
                    <div class="s-icon c-money"><i class="fas fa-users"></i></div>
                    <div class="s-info"><h4>Ø¹Ø¯Ø¯ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</h4><span id="salaryEmpCount">0</span></div>
                </div>
                <div class="stat-card">
                    <div class="s-icon c-money"><i class="fas fa-wallet"></i></div>
                    <div class="s-info"><h4>ØµØ§ÙÙŠ Ø§Ù„Ù…Ø±ØªØ¨Ø§Øª</h4><span id="netSalaries">0</span> Ø¬.Ù…</div>
                </div>
            </div>

            <div class="panel">
                <h3 style="margin-bottom:20px; color:var(--primary); font-weight:800;">Ø¥Ø¯Ø§Ø±Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø±ÙˆØ§ØªØ¨</h3>
                
                <div style="display:grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap:15px; align-items:end; position:relative;">
                    
                    <!-- Autocomplete Input -->
                    <div class="input-group" style="margin-bottom:0; position:relative; z-index:10;">
                        <label>Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù</label>
                        <input type="text" id="salNameInput" class="inp" placeholder="Ø§Ø¨Ø¯Ø£ Ø¨ÙƒØªØ§Ø¨Ø© Ø§Ù„Ø§Ø³Ù…..." onkeyup="suggestNames(this.value)" onblur="setTimeout(()=>hideSuggestions(), 200)">
                        <i class="fas fa-user"></i>
                        <!-- Suggestions List -->
                        <ul id="suggestionList"></ul>
                    </div>

                    <div class="input-group" style="margin-bottom:0;">
                        <label>Ù†ÙˆØ¹ Ø§Ù„Ù‚Ø¨Ø¶</label>
                        <select id="salTypeInput" class="inp" style="padding-right:15px; cursor:pointer;">
                            <option value="monthly">Ø´Ù‡Ø±ÙŠ</option>
                            <option value="weekly">Ø£Ø³Ø¨ÙˆØ¹ÙŠ</option>
                        </select>
                        <i class="fas fa-calendar-alt"></i>
                    </div>

                    <div class="input-group" style="margin-bottom:0;">
                        <label>Ø§Ù„Ù…Ø±ØªØ¨ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ (Ø¬.Ù…)</label>
                        <input type="number" id="salAmountInput" class="inp" placeholder="0.00">
                        <i class="fas fa-dollar-sign"></i>
                    </div>

                    <button class="btn b-money" onclick="addSalary()" style="height:48px; margin-bottom:20px;">
                        <i class="fas fa-save"></i> Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                    </button>
                </div>
            </div>

            <div class="table-wrap">
                <div class="t-head">
                    <div class="view-date">Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø±ØªØ¨Ø§Øª ÙˆØ§Ù„Ù…Ø³Ø­ÙˆØ¨Ø§Øª</div>
                    <div class="nav-btns">
                        <button class="nav-btn" onclick="exportSalariesExcel()"><i class="fas fa-file-excel" style="color:#107c41"></i></button>
                        <button class="nav-btn" onclick="exportSalariesWhatsApp()"><i class="fab fa-whatsapp" style="color:#25D366"></i></button>
                    </div>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Ø§Ù„Ù…ÙˆØ¸Ù</th>
                            <th>Ø§Ù„Ù…Ø±ØªØ¨ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ (Ø¬.Ù…)</th>
                            <th>Ù†ÙˆØ¹ Ø§Ù„Ù‚Ø¨Ø¶</th>
                            <th>Ø§Ù„Ù…Ø³Ø­ÙˆØ¨Ø§Øª (Ø®ØµÙ…)</th>
                            <th style="color:var(--primary); font-weight:800;">Ø§Ù„ØµØ§ÙÙŠ Ø§Ù„Ù…Ø³ØªØ­Ù‚</th>
                            <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                        </tr>
                    </thead>
                    <tbody id="salaryTableBody"></tbody>
                </table>
            </div>
        </div>

        <footer>
            <div class="dev-signature">
                <i class="fas fa-code"></i> ØªÙ… Ø§Ù„ØªØ·ÙˆÙŠØ± Ø¨ÙˆØ§Ø³Ø·Ø© Ø£Ø­Ù…Ø¯ Ø´Ø¹Ø¨Ø§Ù†
            </div>
        </footer>
    </div>
    
    <!-- Toast -->
    <div class="toast success" id="toast"><i class="fas fa-check-circle"></i> <span id="toastMsg">ØªÙ…</span></div>

    <!-- Confirm Modal -->
    <div class="modal" id="confirmModal">
        <div class="modal-content" style="text-align:center; max-width:350px;">
            <div style="font-size:40px; color:var(--danger); margin-bottom:15px;"><i class="fas fa-exclamation-triangle"></i></div>
            <h3 style="margin-bottom:10px;">ØªØ£ÙƒÙŠØ¯</h3>
            <p id="confirmMsg" style="color:var(--gray); margin-bottom:20px;">Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ</p>
            <div style="display:flex; gap:10px; justify-content:center;">
                <button class="btn b-del" id="confirmCancelBtn" style="flex:1;">Ø¥Ù„ØºØ§Ø¡</button>
                <button class="btn b-in" id="confirmOkBtn" style="flex:1;">Ù†Ø¹Ù…</button>
            </div>
        </div>
    </div>

    <!-- EDIT MODAL (Attendance) -->
    <div class="modal" id="editModal">
        <div class="modal-content">
            <div class="m-head">
                <div class="m-title">ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø³Ø¬Ù„</div>
                <button class="m-close" onclick="closeModal('editModal')"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="editDate">
                
                <div class="input-group full">
                    <label>Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù</label>
                    <input type="text" id="editName" class="inp">
                </div>

                <div class="edit-grid">
                    <div class="input-group">
                        <label>ÙˆÙ‚Øª Ø§Ù„Ø­Ø¶ÙˆØ±</label>
                        <input type="time" id="editIn" class="inp">
                    </div>
                    <div class="input-group">
                        <label>ÙˆÙ‚Øª Ø§Ù„Ø§Ù†ØµØ±Ø§Ù</label>
                        <input type="time" id="editOut" class="inp">
                    </div>
                </div>

                <div class="input-group" style="margin-top:15px;">
                    <label style="display:flex; align-items:center; gap:8px; cursor:pointer;">
                        <input type="checkbox" id="editAbsent"> ØªØ³Ø¬ÙŠÙ„ ÙƒØºØ§Ø¦Ø¨ (ÙŠÙ„ØºÙŠ Ø§Ù„Ø£ÙˆÙ‚Ø§Øª)
                    </label>
                </div>

                <div class="input-group">
                    <label>Ø§Ù„Ø®ØµÙ…</label>
                    <input type="text" id="editDeduction" class="inp" placeholder="ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø®ØµÙ…...">
                </div>

                <div class="input-group full">
                    <label>Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©</label>
                    <textarea id="editNotes" class="inp" placeholder="Ø§ÙƒØªØ¨ Ø£ÙŠ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù‡Ù†Ø§..."></textarea>
                </div>

                <button class="btn b-in full" onclick="saveEdit()" style="margin-top:10px;">Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª</button>
            </div>
        </div>
    </div>

    <script>
        // --- GLOBAL DATA ---
        let db = JSON.parse(localStorage.getItem("attnDB")) || {};
        let salaryDB = JSON.parse(localStorage.getItem("salaryDB")) || [];

        const dateIn = document.getElementById('dateFilter');
        dateIn.valueAsDate = new Date();

        // Clock
        function updateClock() {
            const now = new Date();
            document.getElementById('clockDisplay').innerText = now.toLocaleTimeString('en-US', {hour12: true});
        }
        setInterval(updateClock, 1000);
        updateClock();

        // --- TABS LOGIC ---
        function switchTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            
            document.getElementById(tabId).classList.add('active');
            
            const btns = document.querySelectorAll('.tab-btn');
            if(tabId === 'attendance') btns[0].classList.add('active');
            else btns[1].classList.add('active');

            if(tabId === 'attendance') {
                refresh();
                updateStats();
            } else {
                renderSalaries();
                updateSalaryStats();
            }
        }

        // --- SALARIES LOGIC (MANUAL ONLY) ---
        
        function suggestNames(query) {
            const list = document.getElementById('suggestionList');
            list.innerHTML = '';
            if(query.length < 2) { list.style.display = 'none'; return; }

            let allNames = new Set();
            // Search in Attendance DB
            Object.keys(db).forEach(date => {
                db[date].forEach(emp => allNames.add(emp.name));
            });
            // Search in Salary DB
            salaryDB.forEach(s => allNames.add(s.name));

            const matches = Array.from(allNames).filter(name => name.includes(query));
            
            if(matches.length > 0) {
                list.style.display = 'block';
                matches.forEach(name => {
                    const li = document.createElement('li');
                    li.innerText = name;
                    li.onmouseover = () => li.style.background = '#f0f8ff';
                    li.onmouseout = () => li.style.background = 'white';
                    li.onclick = () => {
                        document.getElementById('salNameInput').value = name;
                        // Auto-fill if exists
                        const existing = salaryDB.find(s => s.name === name);
                        if(existing) {
                            document.getElementById('salTypeInput').value = existing.type;
                            document.getElementById('salAmountInput').value = existing.salary;
                        }
                        list.style.display = 'none';
                    };
                    list.appendChild(li);
                });
            } else {
                list.style.display = 'none';
            }
        }

        function hideSuggestions() {
            document.getElementById('suggestionList').style.display = 'none';
        }

        function addSalary() {
            const name = document.getElementById('salNameInput').value.trim();
            const type = document.getElementById('salTypeInput').value; 
            const amount = parseFloat(document.getElementById('salAmountInput').value);

            if (!name || isNaN(amount)) {
                return showToast('Ø¨Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ù…Ø¨Ù„Øº Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­');
            }

            let index = salaryDB.findIndex(s => s.name === name);
            const isUpdate = index > -1;

            const entry = {
                id: isUpdate ? salaryDB[index].id : Date.now(),
                name: name,
                type: type,
                salary: amount,
                deductions: isUpdate ? salaryDB[index].deductions : [], 
                date: isUpdate ? salaryDB[index].date : new Date().toLocaleDateString('en-GB')
            };

            if(isUpdate) {
                salaryDB[index] = entry;
                showToast('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙˆØ¸Ù');
            } else {
                salaryDB.push(entry);
                showToast('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ÙˆØ¸Ù Ø¨Ù†Ø¬Ø§Ø­');
            }

            localStorage.setItem("salaryDB", JSON.stringify(salaryDB));
            
            document.getElementById('salNameInput').value = '';
            document.getElementById('salAmountInput').value = '';
            
            renderSalaries();
            updateSalaryStats();
        }

        function addDeduction(empName) {
            const amount = prompt(`Ø£Ø¯Ø®Ù„ Ù…Ø¨Ù„Øº Ø§Ù„Ø®ØµÙ…/Ø§Ù„Ø³Ù„ÙØ© Ù„Ù„Ù…ÙˆØ¸Ù: ${empName}`);
            if(amount === null || amount.trim() === "") return;
            
            const val = parseFloat(amount);
            if(isNaN(val) || val <= 0) {
                return showToast('Ø§Ù„Ù…Ø¨Ù„Øº ØºÙŠØ± ØµØ­ÙŠØ­');
            }

            const reason = prompt("Ø³Ø¨Ø¨ Ø§Ù„Ø®ØµÙ… (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):", "Ø³Ù„ÙØ©") || "Ø¨Ø¯ÙˆÙ† Ø³Ø¨Ø¨";

            const idx = salaryDB.findIndex(s => s.name === empName);
            if(idx > -1) {
                salaryDB[idx].deductions.push({
                    amount: val,
                    reason: reason,
                    date: new Date().toLocaleDateString('en-GB')
                });
                localStorage.setItem("salaryDB", JSON.stringify(salaryDB));
                renderSalaries();
                updateSalaryStats();
                showToast(`ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø®ØµÙ… Ø¨Ù‚ÙŠÙ…Ø© ${val} Ø¬.Ù…`);
            }
        }

        function renderSalaries() {
            const tbody = document.getElementById('salaryTableBody');
            tbody.innerHTML = '';
            
            if(salaryDB.length === 0) {
                tbody.innerHTML = `<tr><td colspan="7" style="padding:30px; color:#aaa; text-align:center;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø±ØªØ¨Ø§Øª Ù…Ø³Ø¬Ù„Ø©</td></tr>`;
                return;
            }

            salaryDB.forEach((s, index) => {
                const totalDed = s.deductions.reduce((sum, d) => sum + d.amount, 0);
                const netSalary = s.salary - totalDed;
                const typeLabel = s.type === 'weekly' ? 'Ø£Ø³Ø¨ÙˆØ¹ÙŠ' : 'Ø´Ù‡Ø±ÙŠ';

                let dedDetails = s.deductions.length > 0 
                    ? s.deductions.map(d => `${d.reason}: ${d.amount}`).join(' | ') 
                    : 'Ù„Ø§ ÙŠÙˆØ¬Ø¯';

                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${index + 1}</td>
                    <td style="font-weight:bold; color:var(--primary);">${s.name}</td>
                    <td style="font-family:monospace; font-size:16px;">${s.salary.toLocaleString()}</td>
                    <td><span class="badge" style="background:#eee; color:#555;">${typeLabel}</span></td>
                    <td style="color:var(--danger); font-weight:bold;">
                        ${totalDed > 0 ? '-' + totalDed.toLocaleString() : '0'}
                        ${totalDed > 0 ? `<i class="fas fa-info-circle" style="margin-right:5px; cursor:help; font-size:12px;" title="${dedDetails}"></i>` : ''}
                    </td>
                    <td style="color:var(--success); font-weight:bold; font-size:16px;">${netSalary.toLocaleString()}</td>
                    <td>
                        <button class="action-btn" onclick="addDeduction('${s.name}')" title="Ø¥Ø¶Ø§ÙØ© Ø®ØµÙ…/Ø³Ù„ÙØ©"><i class="fas fa-minus-circle" style="color:var(--danger)"></i></button>
                        <button class="action-btn del" onclick="deleteSalary(${s.id})" title="Ø­Ø°Ù Ø§Ù„Ù…ÙˆØ¸Ù"><i class="fas fa-trash"></i></button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        function deleteSalary(id) {
            showConfirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…ÙˆØ¸Ù Ù…Ù† Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø±ØªØ¨Ø§ØªØŸ', () => {
                salaryDB = salaryDB.filter(s => s.id !== id);
                localStorage.setItem("salaryDB", JSON.stringify(salaryDB));
                renderSalaries();
                updateSalaryStats();
                showToast('ØªÙ… Ø§Ù„Ø­Ø°Ù');
            });
        }

        function updateSalaryStats() {
            document.getElementById('salaryEmpCount').innerText = salaryDB.length;
            let totalNet = 0;
            salaryDB.forEach(s => {
                const totalDed = s.deductions.reduce((sum, d) => sum + d.amount, 0);
                totalNet += (s.salary - totalDed);
            });
            document.getElementById('netSalaries').innerText = totalNet.toLocaleString();
        }

        // --- EXPORT FUNCTIONS (ATTENDANCE) ---
        function exportExcel() {
            let tableContent = `<table border="1" style="border-collapse:collapse; direction:rtl; font-family:sans-serif;">
                <tr style="background:#4361ee; color:white;">
                    <th style="padding:10px;">Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                    <th style="padding:10px;">Ø§Ù„Ø§Ø³Ù…</th>
                    <th style="padding:10px;">Ø­Ø¶ÙˆØ±</th>
                    <th style="padding:10px;">Ø§Ù†ØµØ±Ø§Ù</th>
                    <th style="padding:10px;">Ø§Ù„Ø®ØµÙ…</th>
                    <th style="padding:10px;">Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th>
                </tr>`;
            Object.keys(db).sort().reverse().forEach(d => {
                db[d].forEach(e => {
                    tableContent += `<tr>
                        <td style="padding:8px; text-align:center;">${d}</td>
                        <td style="padding:8px; text-align:center;">${e.name}</td>
                        <td style="padding:8px; text-align:center;">${e.attendance||'-'}</td>
                        <td style="padding:8px; text-align:center;">${e.leave||'-'}</td>
                        <td style="padding:8px; text-align:center;">${e.deduction||'-'}</td>
                        <td style="padding:8px; text-align:center;">${e.notes||'-'}</td>
                    </tr>`;
                });
            });
            tableContent += `</table>`;
            
            let blob = new Blob(['\uFEFF', tableContent], { type: 'application/vnd.ms-excel' });
            let url = URL.createObjectURL(blob);
            let a = document.createElement('a');
            a.href = url;
            a.download = 'ØªÙ‚Ø±ÙŠØ±_Ø§Ù„Ø­Ø¶ÙˆØ±.xls';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            showToast('ØªÙ… Ø§Ù„ØªØµØ¯ÙŠØ± Ø¨Ù†Ø¬Ø§Ø­');
        }

        function exportWhatsApp() {
            let k = toKey(dateIn.value); let data = db[k]||[];
            if(!data.length) return showToast('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù‡Ø°Ø§ Ø§Ù„ÙŠÙˆÙ…');
            
            let phone = prompt("Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ Ù…Ø¹ Ù…ÙØªØ§Ø­ Ø§Ù„Ø¯ÙˆÙ„Ø© (Ù…Ø«Ø§Ù„: 201xxxxxxx):");
            if(!phone) return;
            
            phone = phone.replace(/\D/g, ''); 
            let txt = `*ØªÙ‚Ø±ÙŠØ± ÙŠÙˆÙ…: ${k}*\n\n`; 
            data.forEach(e => {
                txt += `ğŸ‘¤ ${e.name}\nâ° Ø§Ù„Ø­Ø¶ÙˆØ±: ${e.attendance||'-'}\nğŸƒ Ø§Ù„Ø§Ù†ØµØ±Ø§Ù: ${e.leave||'-'}\nğŸ“ ${e.notes||e.deduction||'-'}\n------------------\n`;
            });
            window.open(`https://wa.me/${phone}?text=${encodeURIComponent(txt)}`, "_blank");
            
            // Auto Export Excel as requested
            exportExcel();
        }

        // --- EXPORT FUNCTIONS (SALARIES) ---
        function exportSalariesExcel() {
            if(salaryDB.length === 0) return showToast('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„ØªØµØ¯ÙŠØ±');
            
            let tableContent = `<table border="1" style="border-collapse:collapse; direction:rtl; font-family:sans-serif;">
                <tr style="background:#4361ee; color:white;">
                    <th style="padding:10px;">Ø§Ù„Ø§Ø³Ù…</th>
                    <th style="padding:10px;">Ù†ÙˆØ¹ Ø§Ù„Ù‚Ø¨Ø¶</th>
                    <th style="padding:10px;">Ø§Ù„Ù…Ø±ØªØ¨ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ (Ø¬.Ù…)</th>
                    <th style="padding:10px;">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø®ØµÙˆÙ…Ø§Øª</th>
                    <th style="padding:10px;">Ø§Ù„ØµØ§ÙÙŠ Ø§Ù„Ù…Ø³ØªØ­Ù‚</th>
                </tr>`;
            salaryDB.forEach(e => {
                const totalDed = e.deductions.reduce((sum, d) => sum + d.amount, 0);
                const typeLabel = e.type === 'weekly' ? 'Ø£Ø³Ø¨ÙˆØ¹ÙŠ' : 'Ø´Ù‡Ø±ÙŠ';
                tableContent += `<tr>
                    <td style="padding:8px; text-align:center;">${e.name}</td>
                    <td style="padding:8px; text-align:center;">${typeLabel}</td>
                    <td style="padding:8px; text-align:center;">${e.salary}</td>
                    <td style="padding:8px; text-align:center; color:red;">${totalDed}</td>
                    <td style="padding:8px; text-align:center; color:green; font-weight:bold;">${e.salary - totalDed}</td>
                </tr>`;
            });
            tableContent += `</table>`;
            
            let blob = new Blob(['\uFEFF', tableContent], { type: 'application/vnd.ms-excel' });
            let url = URL.createObjectURL(blob);
            let a = document.createElement('a');
            a.href = url;
            a.download = 'Ø¬Ø¯ÙˆÙ„_Ø§Ù„Ù…Ø±ØªØ¨Ø§Øª_Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ.xls';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            showToast('ØªÙ… Ø§Ù„ØªØµØ¯ÙŠØ±');
        }

        function exportSalariesWhatsApp() {
            if(salaryDB.length === 0) return showToast('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø±ØªØ¨Ø§Øª');
            
            let phone = prompt("Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ Ù…Ø¹ Ù…ÙØªØ§Ø­ Ø§Ù„Ø¯ÙˆÙ„Ø©:");
            if(!phone) return;

            phone = phone.replace(/\D/g, ''); 
            let txt = `*Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø±ØªØ¨Ø§Øª*\n\n`; 
            salaryDB.forEach(e => {
                const totalDed = e.deductions.reduce((sum, d) => sum + d.amount, 0);
                const net = e.salary - totalDed;
                txt += `ğŸ‘¤ ${e.name}\nğŸ’° Ø§Ù„Ù…Ø±ØªØ¨: ${e.salary}\nâ– Ø§Ù„Ø®ØµÙˆÙ…Ø§Øª: ${totalDed}\nâœ… Ø§Ù„ØµØ§ÙÙŠ: ${net}\n------------------\n`;
            });
            window.open(`https://wa.me/${phone}?text=${encodeURIComponent(txt)}`, "_blank");

            // Auto Export Excel as requested
            exportSalariesExcel();
        }


        // --- ATTENDANCE LOGIC (Original) ---
        function fmtDate(d) { return d.getDate().toString().padStart(2,'0') + "/" + (d.getMonth()+1).toString().padStart(2,'0') + "/" + d.getFullYear(); }
        function toKey(val) { if(!val) return ""; let [y,m,d] = val.split('-'); return d+"/"+m+"/"+y; }
        function fmtTime(d) { let h=d.getHours(), m=d.getMinutes().toString().padStart(2,'0'); return (h%12||12)+":"+m+(h>=12?"Ù…":"Øµ"); }
        
        function toTimeInput(str) { 
            if(!str) return ""; 
            let cleanStr = str.replace(/[^0-9:]/g, ''); 
            let parts = cleanStr.split(':');
            if(parts.length < 2) return ""; 
            let h = parseInt(parts[0]);
            let m = parts[1] || "00";
            if (isNaN(h)) return ""; 
            let isPM = str.includes('Ù…'); 
            if (isPM && h !== 12) h += 12;
            else if (!isPM && h === 12) h = 0; 
            return h.toString().padStart(2, '0') + ":" + m.padStart(2, '0'); 
        }
        
        function manualFmt(str) { if(!str) return ""; let[h,m]=str.split(':'); h=parseInt(h); return (h%12||12)+":"+m+(h>=12?"Ù…":"Øµ"); }
        function getRowId(name) { return "row-" + name.replace(/\s+/g, '-').replace(/[^\w\-]/g, ''); }

        function save() { localStorage.setItem("attnDB", JSON.stringify(db)); refresh(); updateStats(); }
        function getEmp(day, name) { if(!db[day]) db[day]=[]; let e=db[day].find(x=>x.name==name); if(!e){e={name}; db[day].push(e);} return e; }
        function showToast(msg) { const t=document.getElementById('toast'); document.getElementById('toastMsg').innerText=msg; t.classList.add('show'); setTimeout(()=>t.classList.remove('show'), 3000); }

        let confirmCallback = null;
        function showConfirm(msg, callback) {
            const modal = document.getElementById('confirmModal');
            document.getElementById('confirmMsg').innerText = msg;
            confirmCallback = callback;
            modal.style.display = 'flex';
        }
        document.getElementById('confirmCancelBtn').onclick = function() { closeModal('confirmModal'); confirmCallback = null; };
        document.getElementById('confirmOkBtn').onclick = function() { if(confirmCallback) confirmCallback(); closeModal('confirmModal'); confirmCallback = null; };
        
        function closeModal(id) { document.getElementById(id).style.display = 'none'; }

        function refresh() {
            const key = toKey(dateIn.value);
            document.getElementById('viewDateDisplay').innerText = key;
            const data = db[key] || [];
            const tb = document.getElementById('tableBody'); tb.innerHTML = "";
            
            if(!data.length) { tb.innerHTML = `<tr><td colspan="7" style="padding:30px; color:#aaa;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³Ø¬Ù„Ø§Øª</td></tr>`; return; }
            
            data.forEach(e => {
                let badge = e.absent ? `<span class="badge bg-abs">ØºØ§Ø¦Ø¨</span>` : (e.attendance && e.leave ? `<span class="badge bg-lev">Ù…ØºØ§Ø¯Ø±</span>` : (e.attendance ? `<span class="badge bg-pres">Ø­Ø§Ø¶Ø±</span>` : '-'));
                let notes = e.notes || '-';
                let ded = e.deduction || '-';
                
                const tr = document.createElement('tr');
                tr.id = getRowId(e.name);
                tr.innerHTML = `
                    <td style="font-weight:bold">${e.name}</td>
                    <td style="color:var(--success)">${e.attendance||'-'}</td>
                    <td style="color:var(--danger)">${e.leave||'-'}</td>
                    <td>${badge}</td>
                    <td style="font-size:12px; color:#e67e22">${ded}</td>
                    <td style="font-size:12px; color:#666; max-width:150px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">${notes}</td>
                    <td>
                        <button class="action-btn" onclick="openEdit('${key}','${e.name}')"><i class="fas fa-pen"></i></button>
                        <button class="action-btn del" onclick="delRec('${key}','${e.name}')"><i class="fas fa-trash"></i></button>
                    </td>
                `;
                tb.appendChild(tr);
            });
        }

        dateIn.addEventListener('change', refresh);

        function getT() { return document.getElementById('manualTimeToggle').checked ? manualFmt(document.getElementById('manualTimeInput').value) : fmtTime(new Date()); }
        
        function addAttendance() {
            let n = document.getElementById('employeeName').value.trim(); if(!n) return showToast('Ø£Ø¯Ø®Ù„ Ø§Ù„Ø§Ø³Ù…');
            let k = fmtDate(new Date()); let e = getEmp(k,n);
            if(e.attendance) return showToast('Ù…Ø³Ø¬Ù„ Ù…Ø³Ø¨Ù‚Ø§Ù‹'); e.attendance=getT(); e.absent=""; save(); showToast('ØªÙ… Ø§Ù„Ø­Ø¶ÙˆØ±');
            document.getElementById('employeeName').value="";
        }
        function addLeave() {
            let n = document.getElementById('employeeName').value.trim(); if(!n) return showToast('Ø£Ø¯Ø®Ù„ Ø§Ù„Ø§Ø³Ù…');
            let k = fmtDate(new Date()); let e = getEmp(k,n);
            if(!e.attendance) return showToast('Ù„Ù… ÙŠØ­Ø¶Ø± Ø¨Ø¹Ø¯'); if(e.leave) return showToast('Ø³Ø¬Ù„ Ø§Ù†ØµØ±Ø§Ù'); e.leave=getT(); save(); showToast('ØªÙ… Ø§Ù„Ø§Ù†ØµØ±Ø§Ù');
            document.getElementById('employeeName').value="";
        }
        function markAbsent() {
            let n = document.getElementById('employeeName').value.trim(); if(!n) return showToast('Ø£Ø¯Ø®Ù„ Ø§Ù„Ø§Ø³Ù…');
            let k = fmtDate(new Date()); let e = getEmp(k,n);
            e.absent="ØºØ§Ø¦Ø¨"; e.attendance=""; e.leave=""; save(); showToast('ØªÙ… Ø§Ù„ØºÙŠØ§Ø¨');
            document.getElementById('employeeName').value="";
        }
        function showDeductionInput() {
            let n = document.getElementById('employeeName').value.trim(); if(!n) return showToast('Ø£Ø¯Ø®Ù„ Ø§Ù„Ø§Ø³Ù…');
            let b = document.getElementById('deductionBox'); b.style.display = b.style.display=='block'?'none':'block'; if(b.style.display=='block') document.getElementById('deductionInput').focus();
        }
        function saveDeduction() {
            let n = document.getElementById('employeeName').value.trim(); let txt = document.getElementById('deductionInput').value.trim();
            if(!txt) return showToast('Ø§ÙƒØªØ¨ Ø§Ù„ØªÙØ§ØµÙŠÙ„');
            let e = getEmp(fmtDate(new Date()), n); e.deduction=txt; document.getElementById('deductionInput').value=""; document.getElementById('deductionBox').style.display='none'; save(); showToast('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®ØµÙ…');
        }
        function deleteEmployee() {
            let n = document.getElementById('employeeName').value.trim(); if(!n) return showToast('Ø£Ø¯Ø®Ù„ Ø§Ù„Ø§Ø³Ù…');
            showConfirm('Ø³ÙŠØªÙ… Ø­Ø°Ù Ø³Ø¬Ù„ Ø§Ù„ÙŠÙˆÙ… Ù„Ù„Ù…ÙˆØ¸Ù: ' + n, () => {
                let k = fmtDate(new Date()); 
                if(db[k]) { 
                    db[k]=db[k].filter(x=>x.name!=n); 
                    save(); 
                    showToast('ØªÙ… Ø§Ù„Ø­Ø°Ù'); 
                }
            });
        }

        // EDIT MODAL LOGIC
        window.currentEditName = null; 
        function openEdit(day, name) {
            window.currentEditName = name;
            let e = db[day].find(x=>x.name==name);
            document.getElementById('editDate').value = day;
            document.getElementById('editName').value = e.name;
            document.getElementById('editIn').value = toTimeInput(e.attendance);
            document.getElementById('editOut').value = toTimeInput(e.leave);
            document.getElementById('editAbsent').checked = !!e.absent;
            document.getElementById('editDeduction').value = e.deduction || "";
            document.getElementById('editNotes').value = e.notes || "";
            document.getElementById('editModal').style.display = 'flex';
        }

        function saveEdit() {
            let day = document.getElementById('editDate').value;
            let newName = document.getElementById('editName').value.trim();
            let isAbsent = document.getElementById('editAbsent').checked;
            let ded = document.getElementById('editDeduction').value.trim();
            let note = document.getElementById('editNotes').value.trim();
            let tIn = document.getElementById('editIn').value;
            let tOut = document.getElementById('editOut').value;

            let idx = db[day].findIndex(x => x.name === window.currentEditName);
            if(idx > -1) {
                db[day][idx].name = newName;
                if(isAbsent) {
                    db[day][idx].absent = "ØºØ§Ø¦Ø¨";
                    db[day][idx].attendance = "";
                    db[day][idx].leave = "";
                } else {
                    db[day][idx].absent = "";
                    db[day][idx].attendance = tIn ? manualFmt(tIn) : "";
                    db[day][idx].leave = tOut ? manualFmt(tOut) : "";
                }
                db[day][idx].deduction = ded;
                db[day][idx].notes = note;
                save(); closeModal('editModal'); showToast('ØªÙ… Ø§Ù„ØªØ¹Ø¯ÙŠÙ„');
            }
        }

        function delRec(day, name) { 
            showConfirm('Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø³Ø¬Ù„ Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŸ', () => {
                db[day]=db[day].filter(x=>x.name!=name); 
                if(db[day].length==0) delete db[day]; 
                save(); 
                showToast('ØªÙ… Ø§Ù„Ø­Ø°Ù'); 
            }); 
        }

        function toggleTimeInput() {
            const isChecked = document.getElementById('manualTimeToggle').checked;
            const wrapper = document.getElementById('manualTimeInputGroup');
            if (isChecked) wrapper.classList.add('active');
            else wrapper.classList.remove('active');
        }
        function changeDate(d) { let cur = new Date(dateIn.value); cur.setDate(cur.getDate()+d); dateIn.valueAsDate = cur; refresh(); }
        function setToday() { dateIn.valueAsDate = new Date(); refresh(); }
        function confirmClear() { 
            showConfirm('Ø³ÙŠØªÙ… Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ù†Ø¸Ø§Ù…. Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ', () => { 
                db={}; localStorage.setItem("attnDB", JSON.stringify(db)); save(); showToast('ØªÙ… Ø§Ù„Ù…Ø³Ø­'); 
            }); 
        }
        function toggleTheme() { document.body.classList.toggle('dark-mode'); localStorage.setItem('theme', document.body.classList.contains('dark-mode')?'dark':'light'); }
        if(localStorage.getItem('theme')=='dark') document.body.classList.add('dark-mode');

        function updateStats() {
            let k = fmtDate(new Date()); let p=0, a=0, l=0;
            if(db[k]) db[k].forEach(e => { if(e.absent)a++; else if(e.attendance&&e.leave)l++; else if(e.attendance)p++; });
            document.getElementById('presentCount').innerText=p; document.getElementById('absentCount').innerText=a; document.getElementById('leaveCount').innerText=l;
        }

        // Start
        refresh();
        updateStats();
    </script>
</body>
</html>
